{"version":3,"sources":["./node_modules/bcdice/lib/bcdice/game_system/EarthDawn4.js"],"names":["require","Opal","modules","$rb_gt","lhs","rhs","$rb_lt","$rb_minus","$rb_plus","$rb_ge","self","top","$nesting","nil","$$$","$$","$module","module","$klass","klass","$send2","send2","$truthy","truthy","$send","send","$base","$parent_nesting","concat","$super","$EarthDawn_initialize$1","$EarthDawn_eval_game_system_specific_command$2","$EarthDawn_ed_step$3","$EarthDawn_getStepResult$4","$EarthDawn_getStepTable$5","$EarthDawn_rollStep$6","$$prototype","string","isFailed","const_set","$register_prefix","def","$$initialize","command","$iter","$$p","$yield","find_super_dispatcher","sort_add_dice","$$arity","$$eval_game_system_specific_command","$ed_step","$$ed_step","str","output","$getStepResult","$$getStepResult","stepTotal","step","targetNumber","hasKarmaDice","karmaDiceCount","karmaDiceType","stable","nmod","d20step","d12step","d10step","d8step","d6step","d4step","$case","excelentSuccessNumber","superSuccessNumber","goodSuccessNumber","failedNumber","$last_match","$to_i","$getStepTable","$debug","$rollStep","$to_s","$$getStepTable","mod","d20","d12","d10","d8","d6","d4","exsuc","ssuc","gsuc","nsuc","fsuc","$$rollStep","diceType","diceCount","$$7","i","$$s","$a","dice_now","dice_in","randomizer","$roll_once","$rb_le","$rb_divide","$require","$EarthDawn4_initialize$1","$EarthDawn4_eval_game_system_specific_command$2","$EarthDawn4_ed_step$3","$EarthDawn4_getStepResult$4","$EarthDawn4_getStepResultInfos$5","$EarthDawn4_getStepResultInfo$7","$EarthDawn4_getModifyText$9","$EarthDawn4_getBaseStepTable$10","$EarthDawn4_getStepInfo$11","$EarthDawn4_addStepToResult$13","$EarthDawn4_getSuccess$15","$EarthDawn4_rollStep$16","calcText","$b","stepText","successText","$getStepResultInfos","to_ary","$getSuccess","$$getStepResultInfos","$c","$$6","steps","calcs","totals","target","$ret_or_1","calc","total","value","nextText","$getStepResultInfo","$join","sum","$size","$$getStepResultInfo","$$8","diceModify","stepInfo","diceTypes","modify","$getStepInfo","type","$shift","$getModifyText","$$getModifyText","$$getBaseStepTable","stepTable","$$getStepInfo","$$12","baseStepTable","baseMaxStep","overBounusStep","overStep","stepRythm","result","loopCount","index","restStepInfo","$getBaseStepTable","$last","$first","$get_table_by_number","$addStepToResult","$$addStepToResult","$$14","$writer","to_a","$$getSuccess","diff","level","$$17"],"mappings":"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","file":"default~EarthDawn4~index.js","sourcesContent":["require('./../opal');\n\n/* Generated by Opal 1.1.1 */\nOpal.modules[\"bcdice/game_system/EarthDawn\"] = function(Opal) {\n  function $rb_gt(lhs, rhs) {\n    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs > rhs : lhs['$>'](rhs);\n  }\n  function $rb_lt(lhs, rhs) {\n    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs < rhs : lhs['$<'](rhs);\n  }\n  function $rb_minus(lhs, rhs) {\n    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs - rhs : lhs['$-'](rhs);\n  }\n  function $rb_plus(lhs, rhs) {\n    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs + rhs : lhs['$+'](rhs);\n  }\n  function $rb_ge(lhs, rhs) {\n    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs >= rhs : lhs['$>='](rhs);\n  }\n  var self = Opal.top, $nesting = [], nil = Opal.nil, $$$ = Opal.$$$, $$ = Opal.$$, $module = Opal.module, $klass = Opal.klass, $send2 = Opal.send2, $truthy = Opal.truthy, $send = Opal.send;\n\n  return (function($base, $parent_nesting) {\n    var self = $module($base, 'BCDice');\n\n    var $nesting = [self].concat($parent_nesting);\n\n    (function($base, $parent_nesting) {\n      var self = $module($base, 'GameSystem');\n\n      var $nesting = [self].concat($parent_nesting);\n\n      (function($base, $super, $parent_nesting) {\n        var self = $klass($base, $super, 'EarthDawn');\n\n        var $nesting = [self].concat($parent_nesting), $EarthDawn_initialize$1, $EarthDawn_eval_game_system_specific_command$2, $EarthDawn_ed_step$3, $EarthDawn_getStepResult$4, $EarthDawn_getStepTable$5, $EarthDawn_rollStep$6;\n\n        self.$$prototype.string = self.$$prototype.isFailed = nil;\n        \n        Opal.const_set($nesting[0], 'ID', \"EarthDawn\");\n        Opal.const_set($nesting[0], 'NAME', \"アースドーン\");\n        Opal.const_set($nesting[0], 'SORT_KEY', \"ああすとおん\");\n        Opal.const_set($nesting[0], 'HELP_MESSAGE', \"\" + \"ステップダイス　(xEn+k)\\n\" + \"ステップx、目標値n(省略可能）、カルマダイスk(D2-D20)でステップダイスをロールします。\\n\" + \"振り足しも自動。\\n\" + \"例）9E　10E8　10E+D12\\n\");\n        self.$register_prefix(\"\\\\d+e\");\n        \n        Opal.def(self, '$initialize', $EarthDawn_initialize$1 = function $$initialize(command) {\n          var $iter = $EarthDawn_initialize$1.$$p, $yield = $iter || nil, self = this;\n\n          if ($iter) $EarthDawn_initialize$1.$$p = null;\n          \n          $send2(self, Opal.find_super_dispatcher(self, 'initialize', $EarthDawn_initialize$1, false, true), 'initialize', [command], null);\n          return (self.sort_add_dice = true);\n        }, $EarthDawn_initialize$1.$$arity = 1);\n        \n        Opal.def(self, '$eval_game_system_specific_command', $EarthDawn_eval_game_system_specific_command$2 = function $$eval_game_system_specific_command(command) {\n          var self = this;\n\n          return self.$ed_step(command)\n        }, $EarthDawn_eval_game_system_specific_command$2.$$arity = 1);\n        \n        Opal.def(self, '$ed_step', $EarthDawn_ed_step$3 = function $$ed_step(str) {\n          var self = this, output = nil;\n\n          \n          output = self.$getStepResult(str);\n          return output;\n        }, $EarthDawn_ed_step$3.$$arity = 1);\n        \n        Opal.def(self, '$getStepResult', $EarthDawn_getStepResult$4 = function $$getStepResult(str) {\n          var self = this, stepTotal = nil, step = nil, targetNumber = nil, hasKarmaDice = nil, karmaDiceCount = nil, karmaDiceType = nil, stable = nil, nmod = nil, d20step = nil, d12step = nil, d10step = nil, d8step = nil, d6step = nil, d4step = nil, $case = nil, output = nil, excelentSuccessNumber = nil, superSuccessNumber = nil, goodSuccessNumber = nil, failedNumber = nil;\n\n          \n          if ($truthy(/(\\d+)E(\\d+)?(\\+)?(\\d+)?(d\\d+)?/i['$=~'](str))) {\n          } else {\n            return nil\n          };\n          stepTotal = 0;\n          self.isFailed = true;\n          step = $$($nesting, 'Regexp').$last_match(1).$to_i();\n          targetNumber = 0;\n          hasKarmaDice = false;\n          karmaDiceCount = 0;\n          karmaDiceType = 0;\n          if ($truthy($rb_gt(step, 40))) {\n            step = 40};\n          if ($truthy($$($nesting, 'Regexp').$last_match(2))) {\n            \n            targetNumber = $$($nesting, 'Regexp').$last_match(2).$to_i();\n            if ($truthy($rb_gt(targetNumber, 43))) {\n              targetNumber = 42};};\n          if ($truthy($$($nesting, 'Regexp').$last_match(3))) {\n            hasKarmaDice = $$($nesting, 'Regexp').$last_match(3).$to_i()};\n          if ($truthy($$($nesting, 'Regexp').$last_match(4))) {\n            karmaDiceCount = $$($nesting, 'Regexp').$last_match(4).$to_i()};\n          if ($truthy($$($nesting, 'Regexp').$last_match(5))) {\n            karmaDiceType = $$($nesting, 'Regexp').$last_match(5)};\n          if ($truthy($rb_lt(targetNumber, 0))) {\n            return nil};\n          stable = self.$getStepTable();\n          nmod = stable['$[]'](0)['$[]']($rb_minus(step, 1));\n          d20step = stable['$[]'](1)['$[]']($rb_minus(step, 1));\n          d12step = stable['$[]'](2)['$[]']($rb_minus(step, 1));\n          d10step = stable['$[]'](3)['$[]']($rb_minus(step, 1));\n          d8step = stable['$[]'](4)['$[]']($rb_minus(step, 1));\n          d6step = stable['$[]'](5)['$[]']($rb_minus(step, 1));\n          d4step = stable['$[]'](6)['$[]']($rb_minus(step, 1));\n          if ($truthy(hasKarmaDice)) {\n            $case = karmaDiceType;\n            if (/d20/i['$===']($case)) {d20step = $rb_plus(d20step, karmaDiceCount)}\n            else if (/d12/i['$===']($case)) {d12step = $rb_plus(d12step, karmaDiceCount)}\n            else if (/d10/i['$===']($case)) {d10step = $rb_plus(d10step, karmaDiceCount)}\n            else if (/d8/i['$===']($case)) {d8step = $rb_plus(d8step, karmaDiceCount)}\n            else if (/d6/i['$===']($case)) {d6step = $rb_plus(d6step, karmaDiceCount)}\n            else if (/d4/i['$===']($case)) {d4step = $rb_plus(d4step, karmaDiceCount)}\n            else {nmod = $rb_plus(nmod, karmaDiceCount)}};\n          self.string = \"\";\n          self.$debug(\"d20step, d12step, d10step, d8step, d6step, d4step\", d20step, d12step, d10step, d8step, d6step, d4step);\n          stepTotal = $rb_plus(stepTotal, self.$rollStep(20, d20step));\n          stepTotal = $rb_plus(stepTotal, self.$rollStep(12, d12step));\n          stepTotal = $rb_plus(stepTotal, self.$rollStep(10, d10step));\n          stepTotal = $rb_plus(stepTotal, self.$rollStep(8, d8step));\n          stepTotal = $rb_plus(stepTotal, self.$rollStep(6, d6step));\n          stepTotal = $rb_plus(stepTotal, self.$rollStep(4, d4step));\n          if ($truthy($rb_gt(nmod, 0))) {\n            self.string = $rb_plus(self.string, \"+\")};\n          if ($truthy(nmod['$!='](0))) {\n            \n            self.string = $rb_plus(self.string, nmod.$to_s());\n            stepTotal = $rb_plus(stepTotal, nmod);};\n          self.string = $rb_plus(self.string, \"\" + \" ＞ \" + (stepTotal));\n          output = \"\" + \"ステップ\" + (step) + \" ＞ \" + (self.string);\n          if (targetNumber['$=='](0)) {\n            return output};\n          self.string = $rb_plus(self.string, \" ＞ \");\n          excelentSuccessNumber = stable['$[]'](7)['$[]']($rb_minus(targetNumber, 1));\n          superSuccessNumber = stable['$[]'](8)['$[]']($rb_minus(targetNumber, 1));\n          goodSuccessNumber = stable['$[]'](9)['$[]']($rb_minus(targetNumber, 1));\n          failedNumber = stable['$[]'](11)['$[]']($rb_minus(targetNumber, 1));\n          if ($truthy(self.isFailed)) {\n            self.string = $rb_plus(self.string, \"自動失敗\")\n          } else if ($truthy($rb_ge(stepTotal, excelentSuccessNumber))) {\n            self.string = $rb_plus(self.string, \"最良成功\")\n          } else if ($truthy($rb_ge(stepTotal, superSuccessNumber))) {\n            self.string = $rb_plus(self.string, \"優成功\")\n          } else if ($truthy($rb_ge(stepTotal, goodSuccessNumber))) {\n            self.string = $rb_plus(self.string, \"良成功\")\n          } else if ($truthy($rb_ge(stepTotal, targetNumber))) {\n            self.string = $rb_plus(self.string, \"成功\")\n          } else if ($truthy($rb_lt(stepTotal, failedNumber))) {\n            self.string = $rb_plus(self.string, \"大失敗\")\n          } else {\n            self.string = $rb_plus(self.string, \"失敗\")\n          };\n          output = \"\" + \"ステップ\" + (step) + \">=\" + (targetNumber) + \" ＞ \" + (self.string);\n          return output;\n        }, $EarthDawn_getStepResult$4.$$arity = 1);\n        \n        Opal.def(self, '$getStepTable', $EarthDawn_getStepTable$5 = function $$getStepTable() {\n          var self = this, mod = nil, d20 = nil, d12 = nil, d10 = nil, d8 = nil, d6 = nil, d4 = nil, exsuc = nil, ssuc = nil, gsuc = nil, nsuc = nil, fsuc = nil, stable = nil;\n\n          \n          mod = [-2, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n          d20 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n          d12 = [0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1];\n          d10 = [0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 2, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1, 1, 2, 3, 2, 1, 1, 1, 2, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 2, 1];\n          d8 = [0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 2, 1, 1, 1, 2, 2, 1, 1, 1, 1, 2, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0];\n          d6 = [0, 0, 0, 1, 0, 0, 0, 2, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 2, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 2, 1, 0, 0, 0, 0, 1, 0, 0, 0, 2, 0, 0, 0, 0, 1, 0, 0, 0, 2, 1, 1, 0, 0, 0];\n          d4 = [1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n          exsuc = [6, 8, 10, 12, 14, 17, 19, 20, 22, 24, 25, 27, 29, 32, 33, 35, 37, 38, 39, 41, 42, 44, 45, 47, 48, 49, 51, 52, 54, 55, 56, 58, 59, 60, 62, 64, 65, 67, 68, 70, 71, 72];\n          ssuc = [4, 6, 8, 10, 11, 13, 15, 16, 18, 19, 21, 22, 24, 26, 27, 29, 30, 32, 33, 34, 35, 37, 38, 40, 41, 42, 43, 45, 46, 47, 48, 49, 51, 52, 53, 55, 56, 58, 59, 60, 61, 62];\n          gsuc = [2, 4, 6, 7, 9, 10, 12, 13, 14, 15, 17, 18, 20, 21, 22, 24, 25, 26, 27, 28, 29, 31, 32, 33, 34, 35, 36, 38, 39, 40, 41, 42, 43, 45, 46, 47, 48, 50, 51, 52, 53, 54];\n          nsuc = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42];\n          fsuc = [0, 1, 1, 1, 1, 2, 2, 3, 4, 5, 5, 6, 6, 7, 8, 8, 9, 10, 11, 12, 13, 13, 14, 15, 16, 17, 18, 18, 18, 20, 21, 22, 23, 23, 24, 25, 26, 26, 27, 28, 29, 30];\n          stable = [mod, d20, d12, d10, d8, d6, d4, exsuc, ssuc, gsuc, nsuc, fsuc];\n          return stable;\n        }, $EarthDawn_getStepTable$5.$$arity = 0);\n        return (Opal.def(self, '$rollStep', $EarthDawn_rollStep$6 = function $$rollStep(diceType, diceCount) {\n          var $$7, self = this, stepTotal = nil;\n\n          \n          self.$debug(\"rollStep diceType, diceCount, @string\", diceType, diceCount, self.string);\n          stepTotal = 0;\n          if ($truthy($rb_gt(diceCount, 0))) {\n          } else {\n            return stepTotal\n          };\n          if ($truthy(self.string['$empty?']())) {\n          } else {\n            self.string = $rb_plus(self.string, \"+\")\n          };\n          self.string = $rb_plus(self.string, \"\" + (diceCount) + \"d\" + (diceType) + \"[\");\n          self.$debug(\"rollStep @string\", self.string);\n          $send(diceCount, 'times', [], ($$7 = function(i){var self = $$7.$$s == null ? this : $$7.$$s, $a, dice_now = nil, dice_in = nil;\n            if (self.randomizer == null) self.randomizer = nil;\n            if (self.string == null) self.string = nil;\n\n          \n            \n            if (i == null) {\n              i = nil;\n            };\n            dice_now = self.randomizer.$roll_once(diceType);\n            if ($truthy(dice_now['$!='](1))) {\n              self.isFailed = false};\n            dice_in = dice_now;\n            while (dice_now['$=='](diceType)) {\n              \n              dice_now = self.randomizer.$roll_once(diceType);\n              dice_in = $rb_plus(dice_in, dice_now);\n            };\n            stepTotal = $rb_plus(stepTotal, dice_in);\n            if ($truthy(i['$!='](0))) {\n              self.string = $rb_plus(self.string, \",\")};\n            return (self.string = $rb_plus(self.string, dice_in.$to_s()));}, $$7.$$s = self, $$7.$$arity = 1, $$7));\n          self.string = $rb_plus(self.string, \"]\");\n          return stepTotal;\n        }, $EarthDawn_rollStep$6.$$arity = 2), nil) && 'rollStep';\n      })($nesting[0], $$($nesting, 'Base'), $nesting)\n    })($nesting[0], $nesting)\n  })($nesting[0], $nesting)\n};\n\n/* Generated by Opal 1.1.1 */\n(function(Opal) {\n  function $rb_plus(lhs, rhs) {\n    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs + rhs : lhs['$+'](rhs);\n  }\n  function $rb_gt(lhs, rhs) {\n    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs > rhs : lhs['$>'](rhs);\n  }\n  function $rb_lt(lhs, rhs) {\n    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs < rhs : lhs['$<'](rhs);\n  }\n  function $rb_le(lhs, rhs) {\n    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs <= rhs : lhs['$<='](rhs);\n  }\n  function $rb_minus(lhs, rhs) {\n    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs - rhs : lhs['$-'](rhs);\n  }\n  function $rb_divide(lhs, rhs) {\n    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs / rhs : lhs['$/'](rhs);\n  }\n  var self = Opal.top, $nesting = [], nil = Opal.nil, $$$ = Opal.$$$, $$ = Opal.$$, $module = Opal.module, $klass = Opal.klass, $send2 = Opal.send2, $truthy = Opal.truthy, $send = Opal.send;\n\n  \n  self.$require(\"bcdice/game_system/EarthDawn\");\n  return (function($base, $parent_nesting) {\n    var self = $module($base, 'BCDice');\n\n    var $nesting = [self].concat($parent_nesting);\n\n    (function($base, $parent_nesting) {\n      var self = $module($base, 'GameSystem');\n\n      var $nesting = [self].concat($parent_nesting);\n\n      (function($base, $super, $parent_nesting) {\n        var self = $klass($base, $super, 'EarthDawn4');\n\n        var $nesting = [self].concat($parent_nesting), $EarthDawn4_initialize$1, $EarthDawn4_eval_game_system_specific_command$2, $EarthDawn4_ed_step$3, $EarthDawn4_getStepResult$4, $EarthDawn4_getStepResultInfos$5, $EarthDawn4_getStepResultInfo$7, $EarthDawn4_getModifyText$9, $EarthDawn4_getBaseStepTable$10, $EarthDawn4_getStepInfo$11, $EarthDawn4_addStepToResult$13, $EarthDawn4_getSuccess$15, $EarthDawn4_rollStep$16;\n\n        self.$$prototype.calcText = self.$$prototype.isFailed = nil;\n        \n        Opal.const_set($nesting[0], 'ID', \"EarthDawn4\");\n        Opal.const_set($nesting[0], 'NAME', \"アースドーン4版\");\n        Opal.const_set($nesting[0], 'SORT_KEY', \"ああすとおん4\");\n        Opal.const_set($nesting[0], 'HELP_MESSAGE', \"\" + \"ステップダイス　(xEnK)\\n\" + \"ステップx、目標値n(省略可能）でステップダイスをロール。\\n\" + \"カルマダイス使用時は末尾にKを追加（省略可能）\\n\" + \"例）ステップ10：10E\\n\" + \"　　ステップ10、目標値8：10E8\\n\" + \"　　ステップ10、目標値8、カルマダイス：10E8K\\n\");\n        self.$register_prefix(\"\\\\d+e\");\n        \n        Opal.def(self, '$initialize', $EarthDawn4_initialize$1 = function $$initialize(command) {\n          var $iter = $EarthDawn4_initialize$1.$$p, $yield = $iter || nil, self = this;\n\n          if ($iter) $EarthDawn4_initialize$1.$$p = null;\n          \n          $send2(self, Opal.find_super_dispatcher(self, 'initialize', $EarthDawn4_initialize$1, false, true), 'initialize', [command], null);\n          self.sort_add_dice = true;\n          return (self.calcText = \"\");\n        }, $EarthDawn4_initialize$1.$$arity = 1);\n        \n        Opal.def(self, '$eval_game_system_specific_command', $EarthDawn4_eval_game_system_specific_command$2 = function $$eval_game_system_specific_command(command) {\n          var self = this;\n\n          return self.$ed_step(command)\n        }, $EarthDawn4_eval_game_system_specific_command$2.$$arity = 1);\n        \n        Opal.def(self, '$ed_step', $EarthDawn4_ed_step$3 = function $$ed_step(str) {\n          var self = this, output = nil;\n\n          \n          output = self.$getStepResult(str);\n          return output;\n        }, $EarthDawn4_ed_step$3.$$arity = 1);\n        \n        Opal.def(self, '$getStepResult', $EarthDawn4_getStepResult$4 = function $$getStepResult(str) {\n          var $a, $b, self = this, stepText = nil, calcText = nil, stepTotal = nil, targetNumber = nil, output = nil, successText = nil;\n\n          \n          $b = self.$getStepResultInfos(str), $a = Opal.to_ary($b), (stepText = ($a[0] == null ? nil : $a[0])), (calcText = ($a[1] == null ? nil : $a[1])), (stepTotal = ($a[2] == null ? nil : $a[2])), (targetNumber = ($a[3] == null ? nil : $a[3])), $b;\n          if ($truthy(stepText['$nil?']())) {\n            return nil};\n          if (targetNumber['$=='](0)) {\n            \n            output = \"\" + (stepText) + \" ＞ \" + (calcText) + \" ＞ \" + (stepTotal);\n            return output;};\n          successText = self.$getSuccess(targetNumber, stepTotal);\n          output = \"\" + (stepText) + \">=\" + (targetNumber) + \" ＞ \" + (calcText) + \" ＞ \" + (stepTotal) + \" ＞ \" + (successText);\n          return output;\n        }, $EarthDawn4_getStepResult$4.$$arity = 1);\n        \n        Opal.def(self, '$getStepResultInfos', $EarthDawn4_getStepResultInfos$5 = function $$getStepResultInfos(str) {\n          var $a, $b, $c, $$6, self = this, steps = nil, calcs = nil, totals = nil, target = nil, $ret_or_1 = nil, step = nil, calc = nil, total = nil, value = nil, nextText = nil, stepText = nil, calcText = nil, stepTotal = nil;\n\n          \n          steps = [];\n          calcs = [];\n          totals = [];\n          target = 0;\n          while ($truthy((function() {if ($truthy(($ret_or_1 = str['$nil?']()['$!']()))) {\n            return str['$empty?']()['$!']()\n          } else {\n            return $ret_or_1\n          }; return nil; })())) {\n            \n            self.$debug(\"=====>!! str\", str);\n            $c = self.$getStepResultInfo(str), $b = Opal.to_ary($c), (step = ($b[0] == null ? nil : $b[0])), (calc = ($b[1] == null ? nil : $b[1])), (total = ($b[2] == null ? nil : $b[2])), (value = ($b[3] == null ? nil : $b[3])), (nextText = ($b[4] == null ? nil : $b[4])), $c;\n            self.$debug(\"=====> step\", step);\n            if ($truthy(step['$nil?']())) {\n              return nil};\n            steps['$<<'](step);\n            calcs['$<<'](calc);\n            totals['$<<'](total);\n            if (value['$=='](0)) {\n            } else {\n              target = value\n            };\n            self.$debug(\"=====> nextText\", nextText);\n            if (nextText['$=='](str)) {\n              break;};\n            str = nextText;\n          };\n          stepText = steps.$join(\"+\");\n          calcText = calcs.$join(\")+(\");\n          stepTotal = $send(totals, 'inject', [], ($$6 = function(sum, i){var self = $$6.$$s == null ? this : $$6.$$s;\n\n          \n            \n            if (sum == null) {\n              sum = nil;\n            };\n            \n            if (i == null) {\n              i = nil;\n            };\n            return $rb_plus(sum, i);}, $$6.$$s = self, $$6.$$arity = 2, $$6));\n          if ($truthy($rb_gt(calcs.$size(), 1))) {\n            calcText = $rb_plus($rb_plus(\"(\", calcText), \")\")};\n          if ($truthy($rb_gt(totals.$size(), 1))) {\n            calcText = $rb_plus(calcText, \"\" + \" ＞ (\" + (totals.$join(\"+\")) + \")\")};\n          return [stepText, calcText, stepTotal, target];\n        }, $EarthDawn4_getStepResultInfos$5.$$arity = 1);\n        \n        Opal.def(self, '$getStepResultInfo', $EarthDawn4_getStepResultInfo$7 = function $$getStepResultInfo(str) {\n          var $$8, self = this, stepTotal = nil, step = nil, targetNumber = nil, hasKarmaDice = nil, diceModify = nil, nextText = nil, stepInfo = nil, diceTypes = nil, modify = nil, stepText = nil;\n\n          \n          if ($truthy(/^(\\d+)E(\\d+)?(K)?(\\+\\d+$)?(\\+(.*))?/i['$=~'](str))) {\n          } else {\n            return nil\n          };\n          stepTotal = 0;\n          self.isFailed = true;\n          step = $$($nesting, 'Regexp').$last_match(1).$to_i();\n          targetNumber = $$($nesting, 'Regexp').$last_match(2).$to_i();\n          if ($truthy($rb_lt(targetNumber, 0))) {\n            return nil};\n          hasKarmaDice = $$($nesting, 'Regexp').$last_match(3)['$nil?']()['$!']();\n          diceModify = $$($nesting, 'Regexp').$last_match(4).$to_i();\n          nextText = $$($nesting, 'Regexp').$last_match(6);\n          stepInfo = self.$getStepInfo(step);\n          self.$debug(\"stepInfo\", stepInfo);\n          self.calcText = \"\";\n          diceTypes = [20, 12, 10, 8, 6, 4];\n          $send(diceTypes, 'each', [], ($$8 = function(type){var self = $$8.$$s == null ? this : $$8.$$s;\n\n          \n            \n            if (type == null) {\n              type = nil;\n            };\n            return (stepTotal = $rb_plus(stepTotal, self.$rollStep(type, stepInfo.$shift())));}, $$8.$$s = self, $$8.$$arity = 1, $$8));\n          modify = stepInfo.$shift();\n          if ($truthy(hasKarmaDice)) {\n            stepTotal = $rb_plus(stepTotal, self.$rollStep(6, 1))};\n          self.calcText = $rb_plus(self.calcText, $rb_plus(self.$getModifyText(modify), self.$getModifyText(diceModify)));\n          stepTotal = $rb_plus(stepTotal, $rb_plus(modify, diceModify));\n          stepText = \"\" + \"ステップ\" + (step);\n          return [stepText, self.calcText, stepTotal, targetNumber, nextText];\n        }, $EarthDawn4_getStepResultInfo$7.$$arity = 1);\n        \n        Opal.def(self, '$getModifyText', $EarthDawn4_getModifyText$9 = function $$getModifyText(modify) {\n          var self = this, string = nil;\n\n          \n          string = \"\";\n          if (modify['$=='](0)) {\n            return string};\n          if ($truthy($rb_gt(modify, 0))) {\n            string = $rb_plus(string, \"+\")};\n          string = $rb_plus(string, modify.$to_s());\n          return string;\n        }, $EarthDawn4_getModifyText$9.$$arity = 1);\n        \n        Opal.def(self, '$getBaseStepTable', $EarthDawn4_getBaseStepTable$10 = function $$getBaseStepTable() {\n          var self = this, stepTable = nil;\n\n          \n          stepTable = [[1, [0, 0, 0, 0, 0, 1, -2]], [2, [0, 0, 0, 0, 0, 1, -1]], [3, [0, 0, 0, 0, 0, 1, 0]], [4, [0, 0, 0, 0, 1, 0, 0]], [5, [0, 0, 0, 1, 0, 0, 0]], [6, [0, 0, 1, 0, 0, 0, 0]], [7, [0, 1, 0, 0, 0, 0, 0]]];\n          return stepTable;\n        }, $EarthDawn4_getBaseStepTable$10.$$arity = 0);\n        \n        Opal.def(self, '$getStepInfo', $EarthDawn4_getStepInfo$11 = function $$getStepInfo(step) {\n          var $$12, self = this, baseStepTable = nil, baseMaxStep = nil, overBounusStep = nil, overStep = nil, stepRythm = nil, result = nil, loopCount = nil, index = nil, restStepInfo = nil;\n\n          \n          baseStepTable = self.$getBaseStepTable();\n          baseMaxStep = baseStepTable.$last().$first();\n          if ($truthy($rb_le(step, baseMaxStep))) {\n            return self.$get_table_by_number(step, baseStepTable)};\n          overBounusStep = [1, 0, 0, 0, 0, 0, 0];\n          overStep = $rb_minus($rb_minus(step, baseMaxStep), 1);\n          stepRythm = [[0, 0, 0, 0, 2, 0, 0], [0, 0, 0, 1, 1, 0, 0], [0, 0, 0, 2, 0, 0, 0], [0, 0, 1, 1, 0, 0, 0], [0, 0, 2, 0, 0, 0, 0], [0, 1, 1, 0, 0, 0, 0], [0, 2, 0, 0, 0, 0, 0], [0, 1, 0, 0, 2, 0, 0], [0, 1, 0, 1, 1, 0, 0], [0, 1, 0, 2, 0, 0, 0], [0, 1, 1, 1, 0, 0, 0]];\n          result = [0, 0, 0, 0, 0, 0, 0];\n          loopCount = $rb_divide(overStep, stepRythm.$size()).$to_i();\n          $send(loopCount, 'times', [], ($$12 = function(){var self = $$12.$$s == null ? this : $$12.$$s;\n\n          return self.$addStepToResult(result, overBounusStep)}, $$12.$$s = self, $$12.$$arity = 0, $$12));\n          index = overStep['$%'](stepRythm.$size());\n          restStepInfo = stepRythm['$[]'](index);\n          self.$addStepToResult(result, restStepInfo);\n          return result;\n        }, $EarthDawn4_getStepInfo$11.$$arity = 1);\n        \n        Opal.def(self, '$addStepToResult', $EarthDawn4_addStepToResult$13 = function $$addStepToResult(result, step) {\n          var $$14, self = this;\n\n          \n          $send(result.$size(), 'times', [], ($$14 = function(i){var self = $$14.$$s == null ? this : $$14.$$s, $writer = nil;\n\n          \n            \n            if (i == null) {\n              i = nil;\n            };\n            $writer = [i, $rb_plus(result['$[]'](i), step['$[]'](i))];\n            $send(result, '[]=', Opal.to_a($writer));\n            return $writer[$rb_minus($writer[\"length\"], 1)];}, $$14.$$s = self, $$14.$$arity = 1, $$14));\n          return result;\n        }, $EarthDawn4_addStepToResult$13.$$arity = 2);\n        \n        Opal.def(self, '$getSuccess', $EarthDawn4_getSuccess$15 = function $$getSuccess(targetNumber, stepTotal) {\n          var self = this, diff = nil, level = nil;\n\n          \n          if ($truthy(self.isFailed)) {\n            return \"自動失敗\"};\n          diff = $rb_minus(stepTotal, targetNumber);\n          self.$debug(\"diff\", diff);\n          if ($truthy($rb_lt(diff, 0))) {\n            return \"失敗\"};\n          level = $rb_plus($rb_divide(diff, 5).$to_i(), 1);\n          return \"\" + \"成功 レベル：\" + (level);\n        }, $EarthDawn4_getSuccess$15.$$arity = 2);\n        return (Opal.def(self, '$rollStep', $EarthDawn4_rollStep$16 = function $$rollStep(diceType, diceCount) {\n          var $$17, self = this, stepTotal = nil;\n\n          \n          self.$debug(\"rollStep diceType, diceCount, @calcText\", diceType, diceCount, self.calcText);\n          stepTotal = 0;\n          if ($truthy($rb_gt(diceCount, 0))) {\n          } else {\n            return stepTotal\n          };\n          if ($truthy(self.calcText['$empty?']())) {\n          } else {\n            self.calcText = $rb_plus(self.calcText, \"+\")\n          };\n          self.calcText = $rb_plus(self.calcText, \"\" + (diceCount) + \"d\" + (diceType) + \"[\");\n          self.$debug(\"rollStep string\", self.calcText);\n          $send(diceCount, 'times', [], ($$17 = function(i){var self = $$17.$$s == null ? this : $$17.$$s, $a, dice_now = nil, dice_in = nil;\n            if (self.randomizer == null) self.randomizer = nil;\n            if (self.calcText == null) self.calcText = nil;\n\n          \n            \n            if (i == null) {\n              i = nil;\n            };\n            dice_now = self.randomizer.$roll_once(diceType);\n            if ($truthy(dice_now['$!='](1))) {\n              self.isFailed = false};\n            dice_in = dice_now;\n            while (dice_now['$=='](diceType)) {\n              \n              dice_now = self.randomizer.$roll_once(diceType);\n              dice_in = $rb_plus(dice_in, dice_now);\n            };\n            stepTotal = $rb_plus(stepTotal, dice_in);\n            if ($truthy(i['$!='](0))) {\n              self.calcText = $rb_plus(self.calcText, \",\")};\n            return (self.calcText = $rb_plus(self.calcText, dice_in.$to_s()));}, $$17.$$s = self, $$17.$$arity = 1, $$17));\n          self.calcText = $rb_plus(self.calcText, \"]\");\n          return stepTotal;\n        }, $EarthDawn4_rollStep$16.$$arity = 2), nil) && 'rollStep';\n      })($nesting[0], $$($nesting, 'EarthDawn'), $nesting)\n    })($nesting[0], $nesting)\n  })($nesting[0], $nesting);\n})(Opal);\n"],"sourceRoot":"webpack:///"}