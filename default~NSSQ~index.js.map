{"version":3,"sources":["./node_modules/bcdice/lib/bcdice/game_system/NSSQ.js"],"names":["require","Opal","$rb_plus","lhs","rhs","$rb_ge","$rb_minus","$rb_gt","$rb_le","self","top","$nesting","nil","$$$","$$","$module","module","$klass","klass","$truthy","truthy","$send","send","$base","$parent_nesting","concat","$super","$NSSQ_eval_game_system_specific_command$1","$NSSQ_roll_sq$2","$NSSQ_damage_roll$3","$NSSQ_additional_damage_roll$4","$NSSQ_heal_roll$5","$NSSQ_damage$6","$NSSQ_collecting_roll$8","$NSSQ_result_collecting$10","$$prototype","randomizer","const_set","$register_prefix","def","$$eval_game_system_specific_command","command","$ret_or_1","$ret_or_2","$ret_or_3","$roll_sq","$damage_roll","$heal_roll","$collecting_roll","$$arity","$private","$$roll_sq","m","dice_count","modifier","dice_list","largest_two","total","additional_result","sequence","$match","$to_i","$eval","$roll_barabara","$sort","$reverse","$take","$sum","$join","$modifier","$$damage_roll","critical_up","increase_critical_dice","resist","result","critical_target","$damage","$count","$additional_damage_roll","$$additional_damage_roll","$$heal_roll","$a","$ret_or_4","$$damage","$$7","x","$$s","$$collecting_roll","$$9","type","aatto_param","$case","roll_times","results","i","dice","$result_collecting","$$result_collecting","aatto","$ret_or_5"],"mappings":";;;;;;;;;AAAAA,mBAAO,CAAC,uBAAD,CAAP;AAEA;;;AACA,CAAC,UAASC,IAAT,EAAe;AACd,WAASC,QAAT,CAAkBC,GAAlB,EAAuBC,GAAvB,EAA4B;AAC1B,WAAQ,OAAOD,GAAP,KAAgB,QAAhB,IAA4B,OAAOC,GAAP,KAAgB,QAA7C,GAAyDD,GAAG,GAAGC,GAA/D,GAAqED,GAAG,CAAC,IAAD,CAAH,CAAUC,GAAV,CAA5E;AACD;;AACD,WAASC,MAAT,CAAgBF,GAAhB,EAAqBC,GAArB,EAA0B;AACxB,WAAQ,OAAOD,GAAP,KAAgB,QAAhB,IAA4B,OAAOC,GAAP,KAAgB,QAA7C,GAAyDD,GAAG,IAAIC,GAAhE,GAAsED,GAAG,CAAC,KAAD,CAAH,CAAWC,GAAX,CAA7E;AACD;;AACD,WAASE,SAAT,CAAmBH,GAAnB,EAAwBC,GAAxB,EAA6B;AAC3B,WAAQ,OAAOD,GAAP,KAAgB,QAAhB,IAA4B,OAAOC,GAAP,KAAgB,QAA7C,GAAyDD,GAAG,GAAGC,GAA/D,GAAqED,GAAG,CAAC,IAAD,CAAH,CAAUC,GAAV,CAA5E;AACD;;AACD,WAASG,MAAT,CAAgBJ,GAAhB,EAAqBC,GAArB,EAA0B;AACxB,WAAQ,OAAOD,GAAP,KAAgB,QAAhB,IAA4B,OAAOC,GAAP,KAAgB,QAA7C,GAAyDD,GAAG,GAAGC,GAA/D,GAAqED,GAAG,CAAC,IAAD,CAAH,CAAUC,GAAV,CAA5E;AACD;;AACD,WAASI,MAAT,CAAgBL,GAAhB,EAAqBC,GAArB,EAA0B;AACxB,WAAQ,OAAOD,GAAP,KAAgB,QAAhB,IAA4B,OAAOC,GAAP,KAAgB,QAA7C,GAAyDD,GAAG,IAAIC,GAAhE,GAAsED,GAAG,CAAC,KAAD,CAAH,CAAWC,GAAX,CAA7E;AACD;;AACD,MAAIK,IAAI,GAAGR,IAAI,CAACS,GAAhB;AAAA,MAAqBC,QAAQ,GAAG,EAAhC;AAAA,MAAoCC,GAAG,GAAGX,IAAI,CAACW,GAA/C;AAAA,MAAoDC,GAAG,GAAGZ,IAAI,CAACY,GAA/D;AAAA,MAAoEC,EAAE,GAAGb,IAAI,CAACa,EAA9E;AAAA,MAAkFC,OAAO,GAAGd,IAAI,CAACe,MAAjG;AAAA,MAAyGC,MAAM,GAAGhB,IAAI,CAACiB,KAAvH;AAAA,MAA8HC,OAAO,GAAGlB,IAAI,CAACmB,MAA7I;AAAA,MAAqJC,KAAK,GAAGpB,IAAI,CAACqB,IAAlK;AAEA,SAAQ,UAASC,KAAT,EAAgBC,eAAhB,EAAiC;AACvC,QAAIf,IAAI,GAAGM,OAAO,CAACQ,KAAD,EAAQ,QAAR,CAAlB;AAEA,QAAIZ,QAAQ,GAAG,CAACF,IAAD,EAAOgB,MAAP,CAAcD,eAAd,CAAf;;AAEA,KAAC,UAASD,KAAT,EAAgBC,eAAhB,EAAiC;AAChC,UAAIf,IAAI,GAAGM,OAAO,CAACQ,KAAD,EAAQ,YAAR,CAAlB;AAEA,UAAIZ,QAAQ,GAAG,CAACF,IAAD,EAAOgB,MAAP,CAAcD,eAAd,CAAf;;AAEA,OAAC,UAASD,KAAT,EAAgBG,MAAhB,EAAwBF,eAAxB,EAAyC;AACxC,YAAIf,IAAI,GAAGQ,MAAM,CAACM,KAAD,EAAQG,MAAR,EAAgB,MAAhB,CAAjB;AAEA,YAAIf,QAAQ,GAAG,CAACF,IAAD,EAAOgB,MAAP,CAAcD,eAAd,CAAf;AAAA,YAA+CG,yCAA/C;AAAA,YAA0FC,eAA1F;AAAA,YAA2GC,mBAA3G;AAAA,YAAgIC,8BAAhI;AAAA,YAAgKC,iBAAhK;AAAA,YAAmLC,cAAnL;AAAA,YAAmMC,uBAAnM;AAAA,YAA4NC,0BAA5N;AAEAzB,YAAI,CAAC0B,WAAL,CAAiBC,UAAjB,GAA8BxB,GAA9B;AAEAX,YAAI,CAACoC,SAAL,CAAe1B,QAAQ,CAAC,CAAD,CAAvB,EAA4B,IAA5B,EAAkC,MAAlC;AACAV,YAAI,CAACoC,SAAL,CAAe1B,QAAQ,CAAC,CAAD,CAAvB,EAA4B,MAA5B,EAAoC,mBAApC;AACAV,YAAI,CAACoC,SAAL,CAAe1B,QAAQ,CAAC,CAAD,CAAvB,EAA4B,UAA5B,EAAwC,4BAAxC;AACAV,YAAI,CAACoC,SAAL,CAAe1B,QAAQ,CAAC,CAAD,CAAvB,EAA4B,cAA5B,EAA4C,KAAK,gBAAL,GAAwB,wDAAxB,GAAmF,gCAAnF,GAAsH,IAAtH,GAA6H,0BAA7H,GAA0J,sFAA1J,GAAmP,qBAAnP,GAA2Q,iBAA3Q,GAA+R,0BAA/R,GAA4T,IAA5T,GAAmU,kBAAnU,GAAwV,8BAAxV,GAAyX,qBAAzX,GAAiZ,yBAAjZ,GAA6a,kBAA7a,GAAkc,IAAlc,GAAyc,4BAAzc,GAAwe,uCAAxe,GAAkhB,8BAAlhB,GAAmjB,qBAA/lB;AACAF,YAAI,CAAC6B,gBAAL,CAAsB,oBAAtB,EAA4C,sBAA5C,EAAoE,QAApE,EAA8E,YAA9E;AAEArC,YAAI,CAACsC,GAAL,CAAS9B,IAAT,EAAe,oCAAf,EAAqDkB,yCAAyC,GAAG,SAASa,mCAAT,CAA6CC,OAA7C,EAAsD;AACrJ,cAAIhC,IAAI,GAAG,IAAX;AAAA,cAAiBiC,SAAS,GAAG9B,GAA7B;AAAA,cAAkC+B,SAAS,GAAG/B,GAA9C;AAAA,cAAmDgC,SAAS,GAAGhC,GAA/D;;AAEA,cAAIO,OAAO,CAAEuB,SAAS,GAAI,YAAW;AAAC,gBAAIvB,OAAO,CAAEwB,SAAS,GAAI,YAAW;AAAC,kBAAIxB,OAAO,CAAEyB,SAAS,GAAGnC,IAAI,CAACoC,QAAL,CAAcJ,OAAd,CAAd,CAAX,EAAmD;AAC7H,uBAAOG,SAAP;AACD,eAF2E,MAErE;AACL,uBAAOnC,IAAI,CAACqC,YAAL,CAAkBL,OAAlB,CAAP;AACD;;AAAA;AAAE,qBAAO7B,GAAP;AAAa,aAJ+C,EAAd,CAAX,EAIf;AACrB,qBAAO+B,SAAP;AACD,aANqC,MAM/B;AACL,qBAAOlC,IAAI,CAACsC,UAAL,CAAgBN,OAAhB,CAAP;AACD;;AAAA;AAAE,mBAAO7B,GAAP;AAAa,WARS,EAAd,CAAX,EAQuB;AACrB,mBAAO8B,SAAP;AACD,WAVD,MAUO;AACL,mBAAOjC,IAAI,CAACuC,gBAAL,CAAsBP,OAAtB,CAAP;AACD;AACF,SAhBD,EAgBGd,yCAAyC,CAACsB,OAA1C,GAAoD,CAhBvD;AAiBAxC,YAAI,CAACyC,QAAL;AAEAjD,YAAI,CAACsC,GAAL,CAAS9B,IAAT,EAAe,UAAf,EAA2BmB,eAAe,GAAG,SAASuB,SAAT,CAAmBV,OAAnB,EAA4B;AACvE,cAAIhC,IAAI,GAAG,IAAX;AAAA,cAAiB2C,CAAC,GAAGxC,GAArB;AAAA,cAA0ByC,UAAU,GAAGzC,GAAvC;AAAA,cAA4C0C,QAAQ,GAAG1C,GAAvD;AAAA,cAA4D2C,SAAS,GAAG3C,GAAxE;AAAA,cAA6E4C,WAAW,GAAG5C,GAA3F;AAAA,cAAgG6C,KAAK,GAAG7C,GAAxG;AAAA,cAA6G8C,iBAAiB,GAAG9C,GAAjI;AAAA,cAAsI+C,QAAQ,GAAG/C,GAAjJ;AAGAwC,WAAC,GAAG,sBAAsBQ,MAAtB,CAA6BnB,OAA7B,CAAJ;;AACA,cAAItB,OAAO,CAACiC,CAAD,CAAX,EAAgB,CACf,CADD,MACO;AACL,mBAAOxC,GAAP;AACD;;AAAA;AACDyC,oBAAU,GAAGD,CAAC,CAAC,KAAD,CAAD,CAAS,CAAT,EAAYS,KAAZ,EAAb;AACAP,kBAAQ,GAAGxC,EAAE,CAACH,QAAD,EAAW,qBAAX,CAAF,CAAoCmD,KAApC,CAA0CV,CAAC,CAAC,KAAD,CAAD,CAAS,CAAT,CAA1C,CAAX;AACAG,mBAAS,GAAG9C,IAAI,CAAC2B,UAAL,CAAgB2B,cAAhB,CAA+BV,UAA/B,EAA2C,CAA3C,CAAZ;AACAG,qBAAW,GAAGD,SAAS,CAACS,KAAV,GAAkBC,QAAlB,GAA6BC,KAA7B,CAAmC,CAAnC,CAAd;AACAT,eAAK,GAAGvD,QAAQ,CAACsD,WAAW,CAACW,IAAZ,EAAD,EAAqBb,QAArB,CAAhB;;AACAI,2BAAiB,GAAI,YAAW;AAAC,gBAAIF,WAAW,CAAC,KAAD,CAAX,CAAmB,CAAC,CAAD,EAAI,CAAJ,CAAnB,CAAJ,EAAgC;AAC/D,qBAAO,UAAP;AACD,aAFgC,MAE1B,IAAIA,WAAW,CAAC,KAAD,CAAX,CAAmB,CAAC,CAAD,EAAI,CAAJ,CAAnB,CAAJ,EAAgC;AACrC,qBAAO,SAAP;AACD,aAFM,MAEA;AACL,qBAAO5C,GAAP;AACD;;AAAA;AAAE,mBAAOA,GAAP;AAAa,WANI,EAApB;;AAOA+C,kBAAQ,GAAG,CAAC,KAAK,GAAL,GAAYlB,OAAZ,GAAuB,GAAxB,EAA6B,KAAK,GAAL,GAAYc,SAAS,CAACa,KAAV,CAAgB,GAAhB,CAAZ,GAAoC,GAApC,GAA2CtD,EAAE,CAACH,QAAD,EAAW,QAAX,CAAF,CAAuB0D,SAAvB,CAAiCf,QAAjC,CAAxE,EAAqH,KAAMG,KAAN,GAAe,GAAf,GAAsBD,WAAW,CAACY,KAAZ,CAAkB,GAAlB,CAAtB,GAAgD,GAAhD,GAAuDV,iBAA5K,CAAX;AACA,iBAAOC,QAAQ,CAACS,KAAT,CAAe,KAAf,CAAP;AACD,SAvBD,EAuBGxC,eAAe,CAACqB,OAAhB,GAA0B,CAvB7B;AAyBAhD,YAAI,CAACsC,GAAL,CAAS9B,IAAT,EAAe,cAAf,EAA+BoB,mBAAmB,GAAG,SAASyC,aAAT,CAAuB7B,OAAvB,EAAgC;AACnF,cAAIhC,IAAI,GAAG,IAAX;AAAA,cAAiB2C,CAAC,GAAGxC,GAArB;AAAA,cAA0ByC,UAAU,GAAGzC,GAAvC;AAAA,cAA4C2D,WAAW,GAAG3D,GAA1D;AAAA,cAA+D4D,sBAAsB,GAAG5D,GAAxF;AAAA,cAA6F6D,MAAM,GAAG7D,GAAtG;AAAA,cAA2G2C,SAAS,GAAG3C,GAAvH;AAAA,cAA4H8D,MAAM,GAAG9D,GAArI;AAAA,cAA0I+D,eAAe,GAAG/D,GAA5J;AAGAwC,WAAC,GAAG,yBAAyBQ,MAAzB,CAAgCnB,OAAhC,CAAJ;;AACA,cAAItB,OAAO,CAACiC,CAAD,CAAX,EAAgB,CACf,CADD,MACO;AACL,mBAAOxC,GAAP;AACD;;AAAA;AACDyC,oBAAU,GAAGD,CAAC,CAAC,KAAD,CAAD,CAAS,CAAT,EAAYS,KAAZ,EAAb;AACAU,qBAAW,GAAGnB,CAAC,CAAC,KAAD,CAAD,CAAS,CAAT,EAAY,OAAZ,IAAuB,IAAvB,GAAd;AACAoB,gCAAsB,GAAGpB,CAAC,CAAC,KAAD,CAAD,CAAS,CAAT,EAAY,OAAZ,IAAuB,IAAvB,GAAzB;AACAqB,gBAAM,GAAGrB,CAAC,CAAC,KAAD,CAAD,CAAS,CAAT,EAAYS,KAAZ,EAAT;AACAN,mBAAS,GAAG9C,IAAI,CAAC2B,UAAL,CAAgB2B,cAAhB,CAA+BV,UAA/B,EAA2C,CAA3C,CAAZ;AACAqB,gBAAM,GAAG,KAAK,GAAL,GAAYjC,OAAZ,GAAuB,OAAvB,GAAkCc,SAAS,CAACa,KAAV,CAAgB,GAAhB,CAAlC,GAA0D,GAA1D,GAAiEK,MAAjE,GAA2E,KAA3E,GAAoFhE,IAAI,CAACmE,OAAL,CAAarB,SAAb,EAAwBkB,MAAxB,CAApF,GAAuH,MAAhI;;AACAE,yBAAe,GAAI,YAAW;AAAC,gBAAIxD,OAAO,CAACoD,WAAD,CAAX,EAA0B;AACvD,qBAAO,CAAP;AACD,aAF8B,MAExB;AACL,qBAAO,CAAP;AACD;;AAAA;AAAE,mBAAO3D,GAAP;AAAa,WAJE,EAAlB;;AAKA,cAAIO,OAAO,CAACd,MAAM,CAACC,SAAS,CAACiD,SAAS,CAACsB,MAAV,CAAiB,CAAjB,CAAD,EAAsBtB,SAAS,CAACsB,MAAV,CAAiB,CAAjB,CAAtB,CAAV,EAAsDF,eAAtD,CAAP,CAAX,EAA2F;AAEzFD,kBAAM,GAAGxE,QAAQ,CAACwE,MAAD,EAAS,YAAT,CAAjB;AACAA,kBAAM,GAAGxE,QAAQ,CAACwE,MAAD,EAASjE,IAAI,CAACqE,uBAAL,CAA6BN,sBAA7B,EAAqDC,MAArD,CAAT,CAAjB;AAAyF;;AAAA;AAC3F,iBAAOC,MAAP;AACD,SAzBD,EAyBG7C,mBAAmB,CAACoB,OAApB,GAA8B,CAzBjC;AA2BAhD,YAAI,CAACsC,GAAL,CAAS9B,IAAT,EAAe,yBAAf,EAA0CqB,8BAA8B,GAAG,SAASiD,wBAAT,CAAkCP,sBAAlC,EAA0DC,MAA1D,EAAkE;AAC3I,cAAIhE,IAAI,GAAG,IAAX;AAAA,cAAiB4C,UAAU,GAAGzC,GAA9B;AAAA,cAAmC2C,SAAS,GAAG3C,GAA/C;;AAGAyC,oBAAU,GAAI,YAAW;AAAC,gBAAIlC,OAAO,CAACqD,sBAAD,CAAX,EAAqC;AAC7D,qBAAO,CAAP;AACD,aAFyB,MAEnB;AACL,qBAAO,CAAP;AACD;;AAAA;AAAE,mBAAO5D,GAAP;AAAa,WAJH,EAAb;;AAKA2C,mBAAS,GAAG9C,IAAI,CAAC2B,UAAL,CAAgB2B,cAAhB,CAA+BV,UAA/B,EAA2C,CAA3C,CAAZ;AACA,iBAAO,KAAK,GAAL,GAAYA,UAAZ,GAA0B,IAA1B,GAAkCoB,MAAlC,GAA4C,OAA5C,GAAuDlB,SAAS,CAACa,KAAV,CAAgB,GAAhB,CAAvD,GAA+E,GAA/E,GAAsFK,MAAtF,GAAgG,KAAhG,GAAyGhE,IAAI,CAACmE,OAAL,CAAarB,SAAb,EAAwBkB,MAAxB,CAAzG,GAA4I,MAAnJ;AACD,SAXD,EAWG3C,8BAA8B,CAACmB,OAA/B,GAAyC,CAX5C;AAaAhD,YAAI,CAACsC,GAAL,CAAS9B,IAAT,EAAe,YAAf,EAA6BsB,iBAAiB,GAAG,SAASiD,WAAT,CAAqBvC,OAArB,EAA8B;AAC7E,cAAIwC,EAAJ;AAAA,cAAQxE,IAAI,GAAG,IAAf;AAAA,cAAqB2C,CAAC,GAAGxC,GAAzB;AAAA,cAA8ByC,UAAU,GAAGzC,GAA3C;AAAA,cAAgD6D,MAAM,GAAG7D,GAAzD;AAAA,cAA8DsE,SAAS,GAAGtE,GAA1E;AAAA,cAA+E2C,SAAS,GAAG3C,GAA3F;AAGAwC,WAAC,GAAG,mBAAmBQ,MAAnB,CAA0BnB,OAA1B,CAAJ;;AACA,cAAItB,OAAO,CAACiC,CAAD,CAAX,EAAgB,CACf,CADD,MACO;AACL,mBAAOxC,GAAP;AACD;;AAAA;AACDyC,oBAAU,GAAGD,CAAC,CAAC,KAAD,CAAD,CAAS,CAAT,EAAYS,KAAZ,EAAb;;AACAY,gBAAM,GAAI,YAAW;AAAC,gBAAItD,OAAO,CAAE+D,SAAS,IAAID,EAAE,GAAG7B,CAAC,CAAC,KAAD,CAAD,CAAS,CAAT,CAAL,EAAmB6B,EAAE,KAAKrE,GAAP,IAAcqE,EAAE,IAAI,IAArB,GAA6BrE,GAA7B,GAAmCS,KAAK,CAAC4D,EAAD,EAAK,MAAL,EAAa,EAAb,CAA9D,CAAX,CAAX,EAAyG;AAC7H,qBAAOC,SAAP;AACD,aAFqB,MAEf;AACL,qBAAO,CAAP;AACD;;AAAA;AAAE,mBAAOtE,GAAP;AAAa,WAJP,EAAT;;AAKA2C,mBAAS,GAAG9C,IAAI,CAAC2B,UAAL,CAAgB2B,cAAhB,CAA+BV,UAA/B,EAA2C,CAA3C,CAAZ;AACA,iBAAO,KAAK,GAAL,GAAYZ,OAAZ,GAAuB,OAAvB,GAAkCc,SAAS,CAACa,KAAV,CAAgB,GAAhB,CAAlC,GAA0D,GAA1D,GAAiEK,MAAjE,GAA2E,KAA3E,GAAoFhE,IAAI,CAACmE,OAAL,CAAarB,SAAb,EAAwBkB,MAAxB,CAApF,GAAuH,IAA9H;AACD,SAjBD,EAiBG1C,iBAAiB,CAACkB,OAAlB,GAA4B,CAjB/B;AAmBAhD,YAAI,CAACsC,GAAL,CAAS9B,IAAT,EAAe,SAAf,EAA0BuB,cAAc,GAAG,SAASmD,QAAT,CAAkB5B,SAAlB,EAA6BkB,MAA7B,EAAqC;AAC9E,cAAIW,GAAJ;AAAA,cAAS3E,IAAI,GAAG,IAAhB;;AAEA,iBAAOY,KAAK,CAACkC,SAAD,EAAY,OAAZ,EAAqB,EAArB,GAA0B6B,GAAG,GAAG,aAASC,CAAT,EAAW;AAAC,gBAAI5E,IAAI,GAAG2E,GAAG,CAACE,GAAJ,IAAW,IAAX,GAAkB,IAAlB,GAAyBF,GAAG,CAACE,GAAxC;;AAItD,gBAAID,CAAC,IAAI,IAAT,EAAe;AACbA,eAAC,GAAGzE,GAAJ;AACD;;AAAA;AACD,mBAAOL,MAAM,CAAC8E,CAAD,EAAIZ,MAAJ,CAAb;AAA0B,WAPU,EAORW,GAAG,CAACE,GAAJ,GAAU7E,IAPF,EAOQ2E,GAAG,CAACnC,OAAJ,GAAc,CAPtB,EAOyBmC,GAPnD,EAAZ;AAQD,SAXD,EAWGpD,cAAc,CAACiB,OAAf,GAAyB,CAX5B;AAaAhD,YAAI,CAACsC,GAAL,CAAS9B,IAAT,EAAe,kBAAf,EAAmCwB,uBAAuB,GAAG,SAASsD,iBAAT,CAA2B9C,OAA3B,EAAoC;AAC/F,cAAI+C,IAAJ;AAAA,cAAS/E,IAAI,GAAG,IAAhB;AAAA,cAAsB2C,CAAC,GAAGxC,GAA1B;AAAA,cAA+B6E,IAAI,GAAG7E,GAAtC;AAAA,cAA2C0C,QAAQ,GAAG1C,GAAtD;AAAA,cAA2D8E,WAAW,GAAG9E,GAAzE;AAAA,cAA8E+E,KAAK,GAAG/E,GAAtF;AAAA,cAA2FgF,UAAU,GAAGhF,GAAxG;AAAA,cAA6GiF,OAAO,GAAGjF,GAAvH;;AAGAwC,WAAC,GAAG,uBAAuBQ,MAAvB,CAA8BnB,OAA9B,CAAJ;;AACA,cAAItB,OAAO,CAACiC,CAAD,CAAX,EAAgB,CACf,CADD,MACO;AACL,mBAAOxC,GAAP;AACD;;AAAA;AACD6E,cAAI,GAAGrC,CAAC,CAAC,KAAD,CAAD,CAAS,CAAT,CAAP;AACAE,kBAAQ,GAAGxC,EAAE,CAACH,QAAD,EAAW,qBAAX,CAAF,CAAoCmD,KAApC,CAA0CV,CAAC,CAAC,KAAD,CAAD,CAAS,CAAT,CAA1C,CAAX;;AACAsC,qBAAW,GAAI,YAAW;AAACC,iBAAK,GAAGF,IAAR;;AAC3B,gBAAI,IAAI,MAAJ,EAAYE,KAAZ,CAAJ,EAAwB;AAAC,qBAAO,CAAP;AAAS,aAAlC,MACK,IAAI,IAAI,MAAJ,EAAYA,KAAZ,CAAJ,EAAwB;AAAC,qBAAO,CAAP;AAAS,aAAlC,MACA,IAAI,IAAI,MAAJ,EAAYA,KAAZ,CAAJ,EAAwB;AAAC,qBAAO,CAAP;AAAS,aAAlC,MACA;AAAE,qBAAO/E,GAAP;AAAY;AAAC,WAJN,EAAd;;AAKAgF,oBAAU,GAAG1F,QAAQ,CAACI,SAAS,CAACoF,WAAD,EAAc,CAAd,CAAV,EAA4BpC,QAA5B,CAArB;;AACA,cAAInC,OAAO,CAACX,MAAM,CAACoF,UAAD,EAAa,CAAb,CAAP,CAAX,EAAoC;AAClC,mBAAOhF,GAAP;AAAW;;AAAA;AACbiF,iBAAO,GAAGxE,KAAK,CAACP,EAAE,CAACH,QAAD,EAAW,OAAX,CAAH,EAAwB,KAAxB,EAA+B,CAACiF,UAAD,CAA/B,GAA8CJ,IAAG,GAAG,aAASM,CAAT,EAAW;AAAC,gBAAIrF,IAAI,GAAG+E,IAAG,CAACF,GAAJ,IAAW,IAAX,GAAkB,IAAlB,GAAyBE,IAAG,CAACF,GAAxC;AAAA,gBAA6C/B,SAAS,GAAG3C,GAAzD;AAAA,gBAA8DmF,IAAI,GAAGnF,GAArE;AAC7E,gBAAIH,IAAI,CAAC2B,UAAL,IAAmB,IAAvB,EAA6B3B,IAAI,CAAC2B,UAAL,GAAkBxB,GAAlB;;AAI7B,gBAAIkF,CAAC,IAAI,IAAT,EAAe;AACbA,eAAC,GAAGlF,GAAJ;AACD;;AAAA;AACD2C,qBAAS,GAAG9C,IAAI,CAAC2B,UAAL,CAAgB2B,cAAhB,CAA+B,CAA/B,EAAkC,CAAlC,CAAZ;AACAgC,gBAAI,GAAGxC,SAAS,CAACY,IAAV,EAAP;AACA,mBAAO,KAAK,GAAL,GAAY1B,OAAZ,GAAuB,MAAvB,GAAiCsD,IAAjC,GAAyC,GAAzC,GAAgDxC,SAAS,CAACa,KAAV,CAAgB,GAAhB,CAAhD,GAAwE,KAAxE,GAAiF3D,IAAI,CAACuF,kBAAL,CAAwBF,CAAxB,EAA2BC,IAA3B,EAAiCL,WAAjC,CAAxF;AAAwI,WAV7E,EAU+EF,IAAG,CAACF,GAAJ,GAAU7E,IAVzF,EAU+F+E,IAAG,CAACvC,OAAJ,GAAc,CAV7G,EAUgHuC,IAV9J,EAAf;AAWA,iBAAOK,OAAO,CAACzB,KAAR,CAAc,IAAd,CAAP;AACD,SA/BD,EA+BGnC,uBAAuB,CAACgB,OAAxB,GAAkC,CA/BrC;AAgCA,eAAO,CAAChD,IAAI,CAACsC,GAAL,CAAS9B,IAAT,EAAe,oBAAf,EAAqCyB,0BAA0B,GAAG,SAAS+D,mBAAT,CAA6BH,CAA7B,EAAgCC,IAAhC,EAAsCG,KAAtC,EAA6C;AACrH,cAAIzF,IAAI,GAAG,IAAX;AAAA,cAAiB0F,SAAS,GAAGvF,GAA7B;;AAEA,cAAIO,OAAO,CAAE,YAAW;AAAC,gBAAIA,OAAO,CAAEgF,SAAS,GAAG3F,MAAM,CAACuF,IAAD,EAAOG,KAAP,CAApB,CAAX,EAAgD;AAEvE,qBAAO3F,MAAM,CAACD,SAAS,CAAC4F,KAAD,EAAQ,CAAR,CAAV,EAAsBJ,CAAtB,CAAb;AACD,aAHwB,MAGlB;AACL,qBAAOK,SAAP;AACD;;AAAA;AAAE,mBAAOvF,GAAP;AAAa,WALJ,EAAD,CAAX,EAKsB;AACpB,mBAAO,QAAP;AACD,WAPD,MAOO,IAAIO,OAAO,CAACX,MAAM,CAACF,SAAS,CAAC4F,KAAD,EAAQ,CAAR,CAAV,EAAsBJ,CAAtB,CAAP,CAAX,EAA6C;AAClD,mBAAO,SAAP;AACD,WAFM,MAEA;AACL,mBAAO,IAAP;AACD;AACF,SAfO,EAeL5D,0BAA0B,CAACe,OAA3B,GAAqC,CAfhC,GAeoCrC,GAfrC,KAe6C,mBAfpD;AAgBD,OAjLD,EAiLGD,QAAQ,CAAC,CAAD,CAjLX,EAiLgBG,EAAE,CAACH,QAAD,EAAW,MAAX,CAjLlB,EAiLsCA,QAjLtC;AAkLD,KAvLD,EAuLGA,QAAQ,CAAC,CAAD,CAvLX,EAuLgBA,QAvLhB;AAwLD,GA7LM,CA6LJA,QAAQ,CAAC,CAAD,CA7LJ,EA6LSA,QA7LT,CAAP;AA8LD,CAhND,EAgNGV,IAhNH,E","file":"default~NSSQ~index.js","sourcesContent":["require('./../opal');\n\n/* Generated by Opal 1.1.1 */\n(function(Opal) {\n  function $rb_plus(lhs, rhs) {\n    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs + rhs : lhs['$+'](rhs);\n  }\n  function $rb_ge(lhs, rhs) {\n    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs >= rhs : lhs['$>='](rhs);\n  }\n  function $rb_minus(lhs, rhs) {\n    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs - rhs : lhs['$-'](rhs);\n  }\n  function $rb_gt(lhs, rhs) {\n    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs > rhs : lhs['$>'](rhs);\n  }\n  function $rb_le(lhs, rhs) {\n    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs <= rhs : lhs['$<='](rhs);\n  }\n  var self = Opal.top, $nesting = [], nil = Opal.nil, $$$ = Opal.$$$, $$ = Opal.$$, $module = Opal.module, $klass = Opal.klass, $truthy = Opal.truthy, $send = Opal.send;\n\n  return (function($base, $parent_nesting) {\n    var self = $module($base, 'BCDice');\n\n    var $nesting = [self].concat($parent_nesting);\n\n    (function($base, $parent_nesting) {\n      var self = $module($base, 'GameSystem');\n\n      var $nesting = [self].concat($parent_nesting);\n\n      (function($base, $super, $parent_nesting) {\n        var self = $klass($base, $super, 'NSSQ');\n\n        var $nesting = [self].concat($parent_nesting), $NSSQ_eval_game_system_specific_command$1, $NSSQ_roll_sq$2, $NSSQ_damage_roll$3, $NSSQ_additional_damage_roll$4, $NSSQ_heal_roll$5, $NSSQ_damage$6, $NSSQ_collecting_roll$8, $NSSQ_result_collecting$10;\n\n        self.$$prototype.randomizer = nil;\n        \n        Opal.const_set($nesting[0], 'ID', \"NSSQ\");\n        Opal.const_set($nesting[0], 'NAME', \"SRSじゃない世界樹の迷宮TRPG\");\n        Opal.const_set($nesting[0], 'SORT_KEY', \"えすああるえすしやないせかいしゆのめいきゆうTRPG\");\n        Opal.const_set($nesting[0], 'HELP_MESSAGE', \"\" + \"■ 判定 (xSQ±y)\\n\" + \"  xD6の判定。3つ以上振ったとき、出目の高い2つを表示します。クリティカル、ファンブルも計算します。\\n\" + \"  ±y: yに修正値を入力。±の計算に対応。省略可能。\\n\" + \"\\n\" + \"■ ダメージロール (xDR(C)(+)y)\\n\" + \"  xD6のダメージロール。クリティカルの自動判定を行います。Cを付けるとクリティカルアップ状態で計算できます。+を付けるとクリティカル時のダイスが8個になります。\\n\" + \"  x: xに振るダイス数を入力。\\n\" + \"  y: yに耐性を入力。\\n\" + \"  例) 5DR3 5DRC4 5DRC+4\\n\" + \"\\n\" + \"■ 回復ロール (xHRy)\\n\" + \"  xD6の回復ロール。クリティカルが発生しません。\\n\" + \"  x: xに振るダイス数を入力。\\n\" + \"  y: yに耐性を入力。省略した場合3。\\n\" + \"  例) 2HR 10HR2\\n\" + \"\\n\" + \"■ 採取ロール (TC±z,SC±z,GC±z)\\n\" + \"  ちょっと(T)、そこそこ(S)、がっつり(G)採取採掘伐採を行う。\\n\" + \"  z: zに追加でロールする回数を入力。省略可能。\\n\" + \"  例) TC SC+1 GC-1\\n\");\n        self.$register_prefix(\"\\\\d+SQ[\\\\+\\\\-\\\\d]*\", \"\\\\d+DR(C)?(\\\\+)?\\\\d+\", \"[TSG]C\", \"\\\\d+HR\\\\d*\");\n        \n        Opal.def(self, '$eval_game_system_specific_command', $NSSQ_eval_game_system_specific_command$1 = function $$eval_game_system_specific_command(command) {\n          var self = this, $ret_or_1 = nil, $ret_or_2 = nil, $ret_or_3 = nil;\n\n          if ($truthy(($ret_or_1 = (function() {if ($truthy(($ret_or_2 = (function() {if ($truthy(($ret_or_3 = self.$roll_sq(command)))) {\n            return $ret_or_3\n          } else {\n            return self.$damage_roll(command)\n          }; return nil; })()))) {\n            return $ret_or_2\n          } else {\n            return self.$heal_roll(command)\n          }; return nil; })()))) {\n            return $ret_or_1\n          } else {\n            return self.$collecting_roll(command)\n          }\n        }, $NSSQ_eval_game_system_specific_command$1.$$arity = 1);\n        self.$private();\n        \n        Opal.def(self, '$roll_sq', $NSSQ_roll_sq$2 = function $$roll_sq(command) {\n          var self = this, m = nil, dice_count = nil, modifier = nil, dice_list = nil, largest_two = nil, total = nil, additional_result = nil, sequence = nil;\n\n          \n          m = /(\\d+)SQ([+\\-\\d]+)?/i.$match(command);\n          if ($truthy(m)) {\n          } else {\n            return nil\n          };\n          dice_count = m['$[]'](1).$to_i();\n          modifier = $$($nesting, 'ArithmeticEvaluator').$eval(m['$[]'](2));\n          dice_list = self.randomizer.$roll_barabara(dice_count, 6);\n          largest_two = dice_list.$sort().$reverse().$take(2);\n          total = $rb_plus(largest_two.$sum(), modifier);\n          additional_result = (function() {if (largest_two['$==']([6, 6])) {\n            return \" クリティカル！\"\n          } else if (largest_two['$==']([1, 1])) {\n            return \" ファンブル！\"\n          } else {\n            return nil\n          }; return nil; })();\n          sequence = [\"\" + \"(\" + (command) + \")\", \"\" + \"[\" + (dice_list.$join(\",\")) + \"]\" + ($$($nesting, 'Format').$modifier(modifier)), \"\" + (total) + \"[\" + (largest_two.$join(\",\")) + \"]\" + (additional_result)];\n          return sequence.$join(\" ＞ \");\n        }, $NSSQ_roll_sq$2.$$arity = 1);\n        \n        Opal.def(self, '$damage_roll', $NSSQ_damage_roll$3 = function $$damage_roll(command) {\n          var self = this, m = nil, dice_count = nil, critical_up = nil, increase_critical_dice = nil, resist = nil, dice_list = nil, result = nil, critical_target = nil;\n\n          \n          m = /(\\d+)DR(C)?(\\+)?(\\d+)/i.$match(command);\n          if ($truthy(m)) {\n          } else {\n            return nil\n          };\n          dice_count = m['$[]'](1).$to_i();\n          critical_up = m['$[]'](2)['$nil?']()['$!']();\n          increase_critical_dice = m['$[]'](3)['$nil?']()['$!']();\n          resist = m['$[]'](4).$to_i();\n          dice_list = self.randomizer.$roll_barabara(dice_count, 6);\n          result = \"\" + \"(\" + (command) + \") ＞ [\" + (dice_list.$join(\",\")) + \"]\" + (resist) + \" ＞ \" + (self.$damage(dice_list, resist)) + \"ダメージ\";\n          critical_target = (function() {if ($truthy(critical_up)) {\n            return 1\n          } else {\n            return 2\n          }; return nil; })();\n          if ($truthy($rb_ge($rb_minus(dice_list.$count(6), dice_list.$count(1)), critical_target))) {\n            \n            result = $rb_plus(result, \" クリティカル！\\n\");\n            result = $rb_plus(result, self.$additional_damage_roll(increase_critical_dice, resist));};\n          return result;\n        }, $NSSQ_damage_roll$3.$$arity = 1);\n        \n        Opal.def(self, '$additional_damage_roll', $NSSQ_additional_damage_roll$4 = function $$additional_damage_roll(increase_critical_dice, resist) {\n          var self = this, dice_count = nil, dice_list = nil;\n\n          \n          dice_count = (function() {if ($truthy(increase_critical_dice)) {\n            return 8\n          } else {\n            return 4\n          }; return nil; })();\n          dice_list = self.randomizer.$roll_barabara(dice_count, 6);\n          return \"\" + \"(\" + (dice_count) + \"DR\" + (resist) + \") ＞ [\" + (dice_list.$join(\",\")) + \"]\" + (resist) + \" ＞ \" + (self.$damage(dice_list, resist)) + \"ダメージ\";\n        }, $NSSQ_additional_damage_roll$4.$$arity = 2);\n        \n        Opal.def(self, '$heal_roll', $NSSQ_heal_roll$5 = function $$heal_roll(command) {\n          var $a, self = this, m = nil, dice_count = nil, resist = nil, $ret_or_4 = nil, dice_list = nil;\n\n          \n          m = /^(\\d+)HR(\\d+)?$/i.$match(command);\n          if ($truthy(m)) {\n          } else {\n            return nil\n          };\n          dice_count = m['$[]'](1).$to_i();\n          resist = (function() {if ($truthy(($ret_or_4 = ($a = m['$[]'](2), ($a === nil || $a == null) ? nil : $send($a, 'to_i', []))))) {\n            return $ret_or_4\n          } else {\n            return 3\n          }; return nil; })();\n          dice_list = self.randomizer.$roll_barabara(dice_count, 6);\n          return \"\" + \"(\" + (command) + \") ＞ [\" + (dice_list.$join(\",\")) + \"]\" + (resist) + \" ＞ \" + (self.$damage(dice_list, resist)) + \"回復\";\n        }, $NSSQ_heal_roll$5.$$arity = 1);\n        \n        Opal.def(self, '$damage', $NSSQ_damage$6 = function $$damage(dice_list, resist) {\n          var $$7, self = this;\n\n          return $send(dice_list, 'count', [], ($$7 = function(x){var self = $$7.$$s == null ? this : $$7.$$s;\n\n          \n            \n            if (x == null) {\n              x = nil;\n            };\n            return $rb_gt(x, resist);}, $$7.$$s = self, $$7.$$arity = 1, $$7))\n        }, $NSSQ_damage$6.$$arity = 2);\n        \n        Opal.def(self, '$collecting_roll', $NSSQ_collecting_roll$8 = function $$collecting_roll(command) {\n          var $$9, self = this, m = nil, type = nil, modifier = nil, aatto_param = nil, $case = nil, roll_times = nil, results = nil;\n\n          \n          m = /([TSG])C([+\\-\\d]+)?/i.$match(command);\n          if ($truthy(m)) {\n          } else {\n            return nil\n          };\n          type = m['$[]'](1);\n          modifier = $$($nesting, 'ArithmeticEvaluator').$eval(m['$[]'](2));\n          aatto_param = (function() {$case = type;\n          if (\"T\"['$===']($case)) {return 3}\n          else if (\"S\"['$===']($case)) {return 4}\n          else if (\"G\"['$===']($case)) {return 5}\n          else { return nil }})();\n          roll_times = $rb_plus($rb_minus(aatto_param, 2), modifier);\n          if ($truthy($rb_le(roll_times, 0))) {\n            return nil};\n          results = $send($$($nesting, 'Array'), 'new', [roll_times], ($$9 = function(i){var self = $$9.$$s == null ? this : $$9.$$s, dice_list = nil, dice = nil;\n            if (self.randomizer == null) self.randomizer = nil;\n\n          \n            \n            if (i == null) {\n              i = nil;\n            };\n            dice_list = self.randomizer.$roll_barabara(2, 6);\n            dice = dice_list.$sum();\n            return \"\" + \"(\" + (command) + \") ＞ \" + (dice) + \"[\" + (dice_list.$join(\",\")) + \"]: \" + (self.$result_collecting(i, dice, aatto_param));}, $$9.$$s = self, $$9.$$arity = 1, $$9));\n          return results.$join(\"\\n\");\n        }, $NSSQ_collecting_roll$8.$$arity = 1);\n        return (Opal.def(self, '$result_collecting', $NSSQ_result_collecting$10 = function $$result_collecting(i, dice, aatto) {\n          var self = this, $ret_or_5 = nil;\n\n          if ($truthy((function() {if ($truthy(($ret_or_5 = $rb_le(dice, aatto)))) {\n            \n            return $rb_gt($rb_minus(aatto, 2), i);\n          } else {\n            return $ret_or_5\n          }; return nil; })())) {\n            return \"！ああっと！\"\n          } else if ($truthy($rb_le($rb_minus(aatto, 2), i))) {\n            return \"成功（追加分）\"\n          } else {\n            return \"成功\"\n          }\n        }, $NSSQ_result_collecting$10.$$arity = 3), nil) && 'result_collecting';\n      })($nesting[0], $$($nesting, 'Base'), $nesting)\n    })($nesting[0], $nesting)\n  })($nesting[0], $nesting)\n})(Opal);\n"],"sourceRoot":"webpack:///"}